/*
* MultiSelect v0.9.12
* Copyright (c) 2012 Louis Cuny
*
* This program is free software. It comes without any warranty, to
* the extent permitted by applicable law. You can redistribute it
* and/or modify it under the terms of the Do What The Fuck You Want
* To Public License, Version 2, as published by Sam Hocevar. See
* http://sam.zoy.org/wtfpl/COPYING for more details.
*/
!function(b){var a=function(d,c){this.options=c;this.$element=b(d);this.$container=b("<div/>",{"class":"ms-container"});this.$selectableContainer=b("<div/>",{"class":"ms-selectable"});this.$selectionContainer=b("<div/>",{"class":"ms-selection"});this.$selectableUl=b("<ul/>",{"class":"ms-list","tabindex":"-1"});this.$selectionUl=b("<ul/>",{"class":"ms-list","tabindex":"-1"});this.scrollTo=0;this.elemsSelector="li:visible:not(.ms-optgroup-label,.ms-optgroup-container,."+c.disabledClass+")"};a.prototype={constructor:a,init:function(){var e=this,d=this.$element;if(d.next(".ms-container").length===0){d.css({position:"absolute",left:"-9999px"});d.attr("id",d.attr("id")?d.attr("id"):Math.ceil(Math.random()*1000)+"multiselect");this.$container.attr("id","ms-"+d.attr("id"));this.$container.addClass(e.options.cssClass);d.find("option").each(function(){e.generateLisFromOption(this)});this.$selectionUl.find(".ms-optgroup-label").hide();if(e.options.selectableHeader){e.$selectableContainer.append(e.options.selectableHeader)}e.$selectableContainer.append(e.$selectableUl);if(e.options.selectableFooter){e.$selectableContainer.append(e.options.selectableFooter)}if(e.options.selectionHeader){e.$selectionContainer.append(e.options.selectionHeader)}e.$selectionContainer.append(e.$selectionUl);if(e.options.selectionFooter){e.$selectionContainer.append(e.options.selectionFooter)}e.$container.append(e.$selectableContainer);e.$container.append(e.$selectionContainer);d.after(e.$container);e.activeMouse(e.$selectableUl);e.activeKeyboard(e.$selectableUl);var f=e.options.dblClick?"dblclick":"click";e.$selectableUl.on(f,".ms-elem-selectable",function(){e.select(b(this).data("ms-value"))});e.$selectionUl.on(f,".ms-elem-selection",function(){e.deselect(b(this).data("ms-value"))});e.activeMouse(e.$selectionUl);e.activeKeyboard(e.$selectionUl);d.on("focus",function(){e.$selectableUl.focus()})}var c=d.find("option:selected").map(function(){return b(this).val()}).get();e.select(c,"init");if(typeof e.options.afterInit==="function"){e.options.afterInit.call(this,this.$container)}},"generateLisFromOption":function(k,e,q){var g=this,m=g.$element,h="",p=b(k);for(var i=0;i<k.attributes.length;i++){var o=k.attributes[i];if(o.name!=="value"&&o.name!=="disabled"){h+=o.name+'="'+o.value+'" '}}var s=b("<li "+h+"><span>"+g.escapeHTML(p.text())+"</span></li>"),d=s.clone(),n=p.val(),j=g.sanitize(n);s.data("ms-value",n).addClass("ms-elem-selectable").attr("id",j+"-selectable");d.data("ms-value",n).addClass("ms-elem-selection").attr("id",j+"-selection").hide();if(p.prop("disabled")||m.prop("disabled")){d.addClass(g.options.disabledClass);s.addClass(g.options.disabledClass)}var l=p.parent("optgroup");if(l.length>0){var f=l.attr("label"),c=g.sanitize(f),v=g.$selectableUl.find("#optgroup-selectable-"+c),t=g.$selectionUl.find("#optgroup-selection-"+c);if(v.length===0){var u='<li class="ms-optgroup-container"></li>',r='<ul class="ms-optgroup"><li class="ms-optgroup-label"><span>'+f+"</span></li></ul>";v=b(u);t=b(u);v.attr("id","optgroup-selectable-"+c);t.attr("id","optgroup-selection-"+c);v.append(b(r));t.append(b(r));if(g.options.selectableOptgroup){v.find(".ms-optgroup-label").on("click",function(){var w=l.children(":not(:selected, :disabled)").map(function(){return b(this).val()}).get();g.select(w)});t.find(".ms-optgroup-label").on("click",function(){var w=l.children(":selected:not(:disabled)").map(function(){return b(this).val()}).get();g.deselect(w)})}g.$selectableUl.append(v);g.$selectionUl.append(t)}e=e===undefined?v.find("ul").children().length:e+1;s.insertAt(e,v.children());d.insertAt(e,t.children())}else{e=e===undefined?g.$selectableUl.children().length:e;s.insertAt(e,g.$selectableUl);d.insertAt(e,g.$selectionUl)}},"addOption":function(c){var d=this;if(c.value!==undefined&&c.value!==null){c=[c]}b.each(c,function(e,f){if(f.value!==undefined&&f.value!==null&&d.$element.find("option[value='"+f.value+"']").length===0){var g=b('<option value="'+f.value+'">'+f.text+"</option>"),e=parseInt((typeof f.index==="undefined"?d.$element.children().length:f.index)),h=f.nested===undefined?d.$element:b("optgroup[label='"+f.nested+"']");g.insertAt(e,h);d.generateLisFromOption(g.get(0),e,f.nested)}})},"escapeHTML":function(c){return b("<div>").text(c).html()},"activeKeyboard":function(c){var d=this;c.on("focus",function(){b(this).addClass("ms-focus")}).on("blur",function(){b(this).removeClass("ms-focus")}).on("keydown",function(g){switch(g.which){case 40:case 38:g.preventDefault();g.stopPropagation();d.moveHighlight(b(this),(g.which===38)?-1:1);return;case 37:case 39:g.preventDefault();g.stopPropagation();d.switchList(c);return;case 9:if(d.$element.is("[tabindex]")){g.preventDefault();var f=parseInt(d.$element.attr("tabindex"),10);f=(g.shiftKey)?f-1:f+1;b('[tabindex="'+(f)+'"]').focus();return}else{if(g.shiftKey){d.$element.trigger("focus")}}}if(b.inArray(g.which,d.options.keySelect)>-1){g.preventDefault();g.stopPropagation();d.selectHighlighted(c);return}})},"moveHighlight":function(e,k){var c=e.find(this.elemsSelector),l=c.filter(".ms-hover"),n=null,d=c.first().outerHeight(),o=e.height(),g="#"+this.$container.prop("id");
    c.removeClass("ms-hover");if(k===1){n=l.nextAll(this.elemsSelector).first();if(n.length===0){var f=l.parent();if(f.hasClass("ms-optgroup")){var j=f.parent(),m=j.next(":visible");if(m.length>0){n=m.find(this.elemsSelector).first()}else{n=c.first()}}else{n=c.first()}}}else{if(k===-1){n=l.prevAll(this.elemsSelector).first();if(n.length===0){var f=l.parent();if(f.hasClass("ms-optgroup")){var j=f.parent(),i=j.prev(":visible");if(i.length>0){n=i.find(this.elemsSelector).last()}else{n=c.last()}}else{n=c.last()}}}}if(n.length>0){n.addClass("ms-hover");var h=e.scrollTop()+n.position().top-o/2+d/2;e.scrollTop(h)}},"selectHighlighted":function(c){var e=c.find(this.elemsSelector),d=e.filter(".ms-hover").first();if(d.length>0){if(c.parent().hasClass("ms-selectable")){this.select(d.data("ms-value"))}else{this.deselect(d.data("ms-value"))}e.removeClass("ms-hover")}},"switchList":function(c){c.blur();this.$container.find(this.elemsSelector).removeClass("ms-hover");if(c.parent().hasClass("ms-selectable")){this.$selectionUl.focus()}else{this.$selectableUl.focus()}},"activeMouse":function(c){var d=this;this.$container.on("mouseenter",d.elemsSelector,function(){b(this).parents(".ms-container").find(d.elemsSelector).removeClass("ms-hover");b(this).addClass("ms-hover")});this.$container.on("mouseleave",d.elemsSelector,function(){b(this).parents(".ms-container").find(d.elemsSelector).removeClass("ms-hover")})},"refresh":function(){this.destroy();this.$element.multiSelect(this.options)},"destroy":function(){b("#ms-"+this.$element.attr("id")).remove();this.$element.off("focus");this.$element.css("position","").css("left","");this.$element.removeData("multiselect")},"select":function(l,c){if(typeof l==="string"){l=[l]}var g=this,d=this.$element,h=b.map(l,function(n){return(g.sanitize(n))}),i=this.$selectableUl.find("#"+h.join("-selectable, #")+"-selectable").filter(":not(."+g.options.disabledClass+")"),e=this.$selectionUl.find("#"+h.join("-selection, #")+"-selection").filter(":not(."+g.options.disabledClass+")"),m=d.find("option:not(:disabled)").filter(function(){return(b.inArray(this.value,l)>-1)});if(c==="init"){i=this.$selectableUl.find("#"+h.join("-selectable, #")+"-selectable"),e=this.$selectionUl.find("#"+h.join("-selection, #")+"-selection")}if(i.length>0){i.addClass("ms-selected").hide();e.addClass("ms-selected").show();m.prop("selected",true);g.$container.find(g.elemsSelector).removeClass("ms-hover");var k=g.$selectableUl.children(".ms-optgroup-container");if(k.length>0){k.each(function(){var n=b(this).find(".ms-elem-selectable");if(n.length===n.filter(".ms-selected").length){b(this).find(".ms-optgroup-label").hide()}});var j=g.$selectionUl.children(".ms-optgroup-container");j.each(function(){var n=b(this).find(".ms-elem-selection");if(n.filter(".ms-selected").length>0){b(this).find(".ms-optgroup-label").show()}})}else{if(g.options.keepOrder&&c!=="init"){var f=g.$selectionUl.find(".ms-selected");if((f.length>1)&&(f.last().get(0)!=e.get(0))){e.insertAfter(f.last())}}}if(c!=="init"){d.trigger("change");if(typeof g.options.afterSelect==="function"){g.options.afterSelect.call(this,l)}}}},"deselect":function(j){if(typeof j==="string"){j=[j]}var e=this,c=this.$element,f=b.map(j,function(l){return(e.sanitize(l))}),g=this.$selectableUl.find("#"+f.join("-selectable, #")+"-selectable"),d=this.$selectionUl.find("#"+f.join("-selection, #")+"-selection").filter(".ms-selected").filter(":not(."+e.options.disabledClass+")"),k=c.find("option").filter(function(){return(b.inArray(this.value,j)>-1)});if(d.length>0){g.removeClass("ms-selected").show();d.removeClass("ms-selected").hide();k.prop("selected",false);e.$container.find(e.elemsSelector).removeClass("ms-hover");var i=e.$selectableUl.children(".ms-optgroup-container");if(i.length>0){i.each(function(){var l=b(this).find(".ms-elem-selectable");if(l.filter(":not(.ms-selected)").length>0){b(this).find(".ms-optgroup-label").show()}});var h=e.$selectionUl.children(".ms-optgroup-container");h.each(function(){var l=b(this).find(".ms-elem-selection");if(l.filter(".ms-selected").length===0){b(this).find(".ms-optgroup-label").hide()}})}c.trigger("change");if(typeof e.options.afterDeselect==="function"){e.options.afterDeselect.call(this,j)}}},"select_all":function(){var e=this.$element,d=e.val();e.find('option:not(":disabled")').prop("selected",true);this.$selectableUl.find(".ms-elem-selectable").filter(":not(."+this.options.disabledClass+")").addClass("ms-selected").hide();this.$selectionUl.find(".ms-optgroup-label").show();this.$selectableUl.find(".ms-optgroup-label").hide();this.$selectionUl.find(".ms-elem-selection").filter(":not(."+this.options.disabledClass+")").addClass("ms-selected").show();this.$selectionUl.focus();e.trigger("change");if(typeof this.options.afterSelect==="function"){var c=b.grep(e.val(),function(f){return b.inArray(f,d)<0});this.options.afterSelect.call(this,c)}},"deselect_all":function(){var d=this.$element,c=d.val();d.find("option").prop("selected",false);this.$selectableUl.find(".ms-elem-selectable").removeClass("ms-selected").show();
    this.$selectionUl.find(".ms-optgroup-label").hide();this.$selectableUl.find(".ms-optgroup-label").show();this.$selectionUl.find(".ms-elem-selection").removeClass("ms-selected").hide();this.$selectableUl.focus();d.trigger("change");if(typeof this.options.afterDeselect==="function"){this.options.afterDeselect.call(this,c)}},sanitize:function(f){var g=0,d,e;if(f.length==0){return g}var c=0;for(d=0,c=f.length;d<c;d++){e=f.charCodeAt(d);g=((g<<5)-g)+e;g|=0}return g}};b.fn.multiSelect=function(){var d=arguments[0],c=arguments;return this.each(function(){var g=b(this),f=g.data("multiselect"),e=b.extend({},b.fn.multiSelect.defaults,g.data(),typeof d==="object"&&d);if(!f){g.data("multiselect",(f=new a(this,e)))}if(typeof d==="string"){f[d](c[1])}else{f.init()}})};b.fn.multiSelect.defaults={keySelect:[32],selectableOptgroup:false,disabledClass:"disabled",dblClick:false,keepOrder:false,cssClass:""};b.fn.multiSelect.Constructor=a;b.fn.insertAt=function(c,d){return this.each(function(){if(c===0){d.prepend(this)}else{d.children().eq(c-1).after(this)}})}}(window.jQuery);
